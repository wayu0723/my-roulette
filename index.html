<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ã‚­ãƒ‰ã‚­ï¼ãŠå¹´ç‰ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background: #fdf2f2; padding: 20px; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 4px solid #e63946; }
        h1 { color: #e63946; font-size: 1.5rem; margin-bottom: 20px; }
        
        /* ã‚³ãƒ¼ã‚¹é¸æŠãƒœã‚¿ãƒ³ */
        .course-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-course { padding: 15px; border: 2px solid #ddd; border-radius: 15px; cursor: pointer; background: #fff; font-weight: bold; transition: 0.3s; }
        .btn-course.active { background: #e63946; color: white; border-color: #e63946; transform: scale(1.05); }

        /* ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæœ¬ä½“ */
        .roulette-box { position: relative; margin: 30px auto; width: 300px; height: 300px; }
        canvas { width: 100%; height: 100%; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
        .arrow { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #333; z-index: 10; }

        /* æ“ä½œã‚¨ãƒªã‚¢ */
        .controls { margin-top: 20px; }
        .base-input { margin-bottom: 15px; display: none; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 8px; width: 80%; font-size: 1rem; text-align: center; }
        .btn-spin { background: #f1faee; border: 3px solid #e63946; color: #e63946; padding: 15px 40px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; cursor: pointer; width: 100%; box-shadow: 0 5px 0 #d62828; margin-top: 10px; }
        .btn-spin:active { transform: translateY(3px); box-shadow: none; }
        .btn-spin:disabled { background: #eee; border-color: #ccc; color: #999; box-shadow: none; }

        #result { margin-top: 20px; font-size: 2rem; font-weight: bold; color: #e63946; min-height: 2.5rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ§§ ãƒ‰ã‚­ãƒ‰ã‚­ãŠå¹´ç‰ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>

    <div class="course-selector" id="selectors">
        <button class="btn-course active" onclick="selectCourse('sakuya')">ã•ãã‚„<br>ã‚³ãƒ¼ã‚¹</button>
        <button class="btn-course" onclick="selectCourse('reiya')">ã‚Œã„ã‚„<br>ã‚³ãƒ¼ã‚¹</button>
        <button class="btn-course" onclick="selectCourse('souya')">ãã†ã‚„<br>ã‚³ãƒ¼ã‚¹</button>
        <button class="btn-course" onclick="selectCourse('extra')">ã€‡ã€‡<br>ã‚³ãƒ¼ã‚¹</button>
    </div>

    <div id="baseInputArea" class="base-input">
        <input type="number" id="baseAmount" placeholder="ãƒ™ãƒ¼ã‚¹é‡‘é¡ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š2000ï¼‰">
    </div>

    <div class="roulette-box">
        <div class="arrow"></div>
        <canvas id="canvas" width="300" height="300"></canvas>
    </div>

    <div id="result"></div>

    <div class="controls">
        <button id="spinBtn" class="btn-spin" onclick="spin()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
    </div>
</div>

<script>
    // ã‚³ãƒ¼ã‚¹è¨­å®š
    const courses = {
        sakuya: { items: ["3,000å††", "4,000å††", "5,000å††", "ã‚‚ã†ä¸€å›"], weights: [40, 30, 20, 10] },
        reiya:  { items: ["5,000å††", "6,000å††", "7,000å††", "ã‚‚ã†ä¸€å›"], weights: [40, 30, 20, 10] },
        souya:  { items: ["7,000å††", "8,000å††", "9,000å††", "ã‚‚ã†ä¸€å›"], weights: [40, 30, 20, 10] },
        extra:  { items: ["1,000å††", "ãƒ™ãƒ¼ã‚¹", "10,000å††", "ã‚‚ã†ä¸€å›"], weights: [30, 30, 30, 10] }
    };

    let currentCourse = 'sakuya';
    let currentRotation = 0;
    const colors = ["#ffadad", "#ffd6a5", "#fdffb6", "#caffbf"];
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resultDiv = document.getElementById('result');
    const spinBtn = document.getElementById('spinBtn');

    // ã‚³ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆ
    function selectCourse(courseId) {
        currentCourse = courseId;
        // UIæ›´æ–°
        document.querySelectorAll('.btn-course').forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');
        
        // ã€‡ã€‡ã‚³ãƒ¼ã‚¹ã®ã¨ãã ã‘ãƒ™ãƒ¼ã‚¹å…¥åŠ›ã‚’è¡¨ç¤º
        document.getElementById('baseInputArea').style.display = (courseId === 'extra') ? 'block' : 'none';
        
        resultDiv.innerText = "";
        draw();
    }

    // æç”»
    function draw() {
        const items = courses[currentCourse].items;
        const arc = (Math.PI * 2) / items.length;
        
        ctx.clearRect(0, 0, 300, 300);
        items.forEach((text, i) => {
            const angle = i * arc;
            ctx.fillStyle = colors[i % colors.length];
            ctx.beginPath();
            ctx.moveTo(150, 150);
            ctx.arc(150, 150, 145, angle, angle + arc);
            ctx.fill();
            ctx.stroke();

            ctx.save();
            ctx.translate(150, 150);
            ctx.rotate(angle + arc / 2);
            ctx.fillStyle = "#333";
            ctx.font = "bold 16px sans-serif";
            ctx.textAlign = "right";
            ctx.fillText(text, 130, 10);
            ctx.restore();
        });
    }

    // å›è»¢å‡¦ç†
    function spin() {
        spinBtn.disabled = true;
        resultDiv.innerText = "ã¾ã‚ã£ã¦ã„ã¾ã™...";

        const config = courses[currentCourse];
        const weights = config.weights;
        const totalWeight = weights.reduce((a, b) => a + b, 0);
        
        // é‡ã¿ã«åŸºã¥ã„ã¦å½“é¸ã‚’æ±ºå®š
        let random = Math.random() * totalWeight;
        let selectedIndex = 0;
        for (let i = 0; i < weights.length; i++) {
            if (random < weights[i]) {
                selectedIndex = i;
                break;
            }
            random -= weights[i];
        }

        // åœæ­¢ä½ç½®ã®è¨ˆç®—ï¼ˆé‡ãŒä¸Š(270åº¦)ã«ã‚ã‚‹å‰æï¼‰
        const segmentAngle = 360 / config.items.length;
        const targetAngle = 270 - (segmentAngle * selectedIndex) - (segmentAngle / 2);
        const extraSpins = 360 * 5; // 5å›è»¢ã•ã›ã‚‹
        currentRotation += extraSpins + (targetAngle - (currentRotation % 360)) + 360;

        canvas.style.transform = `rotate(${currentRotation}deg)`;

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã®å‡¦ç†
        setTimeout(() => {
            let finalResult = config.items[selectedIndex];
            if (finalResult === "ãƒ™ãƒ¼ã‚¹") {
                const base = document.getElementById('baseAmount').value || "ï¼Ÿï¼Ÿï¼Ÿ";
                finalResult = base + "å††";
            }
            resultDiv.innerText = "çµæœï¼š " + finalResult;
            spinBtn.disabled = false;
        }, 5000);
    }

    draw();
</script>

</body>
</html>
