<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‰ã‚­ãƒ‰ã‚­ï¼ãŠå¹´ç‰ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆï¼ˆä¿®æ­£ç‰ˆï¼‰</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background: #fff5f5; padding: 20px; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 4px solid #d62828; }
        h1 { color: #d62828; font-size: 1.4rem; margin-bottom: 20px; letter-spacing: 1px; }
        
        .course-selector { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .btn-course { padding: 12px 5px; border: 2px solid #eee; border-radius: 12px; cursor: pointer; background: #fff; font-weight: bold; font-size: 0.9rem; transition: 0.3s; color: #666; }
        .btn-course.active { background: #d62828; color: white; border-color: #d62828; transform: scale(1.05); }

        .roulette-box { position: relative; margin: 30px auto; width: 300px; height: 300px; }
        canvas { width: 100%; height: 100%; transition: transform 5s cubic-bezier(0.1, 0, 0.2, 1); }
        .arrow { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 40px solid #333; z-index: 10; }

        #result { margin: 20px 0; font-size: 1.8rem; font-weight: bold; color: #d62828; min-height: 2.5rem; border-bottom: 2px dashed #eee; padding-bottom: 10px; }
        .btn-spin { background: #fdf2f2; border: 3px solid #d62828; color: #d62828; padding: 15px; border-radius: 50px; font-size: 1.4rem; font-weight: bold; cursor: pointer; width: 100%; box-shadow: 0 5px 0 #b91d1d; }
        .btn-spin:active { transform: translateY(3px); box-shadow: none; }
        .btn-spin:disabled { background: #eee; border-color: #ccc; color: #999; box-shadow: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ§§ ãƒ‰ã‚­ãƒ‰ã‚­ï¼ãŠå¹´ç‰ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>

    <div class="course-selector">
        <button class="btn-course active" onclick="selectCourse('sakuya')">ã•ãã‚„<br>ã‚³ãƒ¼ã‚¹</button>
        <button class="btn-course" onclick="selectCourse('reiya')">ã‚Œã„ã‚„<br>ã‚³ãƒ¼ã‚¹</button>
        <button class="btn-course" onclick="selectCourse('souya')">ãã†ã‚„<br>ã‚³ãƒ¼ã‚¹</button>
    </div>

    <div class="roulette-box">
        <div class="arrow"></div>
        <canvas id="canvas" width="300" height="300"></canvas>
    </div>

    <div id="result"></div>
    <button id="spinBtn" class="btn-spin" onclick="spin()">ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆé–‹å§‹ï¼</button>
</div>

<script>
    const courses = {
        sakuya: { 
            items: ["5,000å††", "6,000å††", "7,000å††", "ã‚‚ã†ä¸€å›"], 
            weights: [40, 30, 20, 10] 
        },
        reiya: { 
            items: ["7,000å††", "8,000å††", "9,000å††", "ã‚‚ã†ä¸€å›"], 
            weights: [40, 30, 20, 10] 
        },
        souya: { 
            items: ["1,000å††", "10,000å††", "ã¾ãŸæ¥å¹´ãŒã‚“ã°ã‚ã†"], 
            weights: [24, 1, 75] // ã”æŒ‡å®šã®æ¯”ç‡
        }
    };

    let currentCourse = 'sakuya';
    let currentRotation = 0;
    const colors = ["#ffadad", "#ffd6a5", "#fdffb6", "#caffbf"];
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resultDiv = document.getElementById('result');
    const spinBtn = document.getElementById('spinBtn');

    function selectCourse(courseId) {
        if (spinBtn.disabled) return;
        currentCourse = courseId;
        document.querySelectorAll('.btn-course').forEach(btn => {
            btn.classList.remove('active');
            if(btn.innerText.includes(courseId === 'sakuya' ? 'ã•ãã‚„' : courseId === 'reiya' ? 'ã‚Œã„ã‚„' : 'ãã†ã‚„')) {
                btn.classList.add('active');
            }
        });
        resultDiv.innerText = "";
        draw();
    }

    function draw() {
        const config = courses[currentCourse];
        const totalWeight = config.weights.reduce((a, b) => a + b, 0);
        let startAngle = -Math.PI / 2;
        
        ctx.clearRect(0, 0, 300, 300);
        
        config.items.forEach((text, i) => {
            const weight = config.weights[i];
            const arc = (weight / totalWeight) * (Math.PI * 2);
            const arcDeg = (weight / totalWeight) * 360; // è§’åº¦ï¼ˆåº¦æ•°æ³•ï¼‰
            
            // æ‰‡å½¢ã‚’æç”»
            ctx.fillStyle = colors[i % colors.length];
            ctx.beginPath();
            ctx.moveTo(150, 150);
            ctx.arc(150, 150, 145, startAngle, startAngle + arc);
            ctx.fill();
            ctx.strokeStyle = "#fff";
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // --- æ–‡å­—ã®æç”»ãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„ ---
            ctx.save();
            ctx.translate(150, 150);
            ctx.rotate(startAngle + arc / 2);
            
            ctx.fillStyle = "#333";
            ctx.textAlign = "right";

            // æ¯”ç‡ãŒéå¸¸ã«å°ã•ã„ï¼ˆ5åº¦æœªæº€ï¼‰å ´åˆã®è¨­å®š
            if (arcDeg < 5) {
                ctx.font = "bold 9px sans-serif"; // æ–‡å­—ã‚’å°ã•ã
                ctx.fillText(text, 142, 3);      // å°‘ã—å¤–å´ã¸
            } 
            // ä¸­ãã‚‰ã„ã®å ´åˆ
            else if (arcDeg < 15) {
                ctx.font = "bold 11px sans-serif";
                ctx.fillText(text, 140, 4);
            } 
            // é€šå¸¸ã®å ´åˆ
            else {
                ctx.font = "bold
